window.__require=function t(e,o,n){function i(s,a){if(!o[s]){if(!e[s]){var h=s.split("/");if(h=h[h.length-1],!e[h]){var r="function"==typeof __require&&__require;if(!a&&r)return r(h,!0);if(c)return c(h,!0);throw new Error("Cannot find module '"+s+"'")}}var u=o[s]={exports:{}};e[s][0].call(u.exports,function(t){return i(e[s][1][t]||t)},u,u.exports,t,e,o,n)}return o[s].exports}for(var c="function"==typeof __require&&__require,s=0;s<n.length;s++)i(n[s]);return i}({BombManager:[function(t,e,o){"use strict";cc._RF.push(e,"56f73yKDhlCsahMKFdNXxIX","BombManager"),cc.Class({extends:cc.Component,properties:{bomb:cc.Node},onLoad:function(){var t=this.bomb.parent,e=cc.instantiate(this.bomb);e.parent=t;var o=[],n=this.bomb.getComponent("Bomb");n.addBomb(30),o.push(n),(n=e.getComponent("Bomb")).addBomb(30),o.push(n),this.cmps=o},lanuchOn:function(t){for(var e=[],o=0;o<this.cmps.length;o++){var n=this.cmps[o],i=n.getLen();if(i<20)return void n.lanuch(t);e.push([i,n])}2==e.length&&(e.sort(function(t,e){return t[0]<e[0]}),e[0][1].lanuch(t))}}),cc._RF.pop()},{}],Bomb:[function(t,e,o){"use strict";cc._RF.push(e,"5fcfc4Z7clDXoeudR1g8txp","Bomb");var n=function(t,e){return Math.random()*(e-t)+t},i=Math.abs;cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.curArr=[],this.hideSelf()},hideSelf:function(){this.node.position=cc.v3(0,-5e3,2e3)},testLanuch:function(){var t=this,e=cc.v3(0,500,0);this.scheduleOnce(function(){t.lanuch(e)},2)},addBomb:function(t){for(var e=this.node.children[0],o=0;o<t;o++){cc.instantiate(e).parent=this.node}},getLen:function(){return this.curArr.length},lanuch:function(t){this.node.position=t,this.curArr.length=0;for(var e=this.node.children,o=0,n=e.length;o<n;o++){var i=e[o];i.position=cc.v3(0,0,0),i.setScale(30,30,30),this.curArr.push(i)}},update:function(t){if(!(this.curArr.length<1))for(var e=0;e<this.curArr.length;e++){var o=this.curArr[e];0==o.x&&(o.dx=n(-20,20)),o.x+=o.dx,0==o.y&&(o.dy=n(-20,20)),o.y+=o.dy,0==o.z&&(o.dz=n(-20,20)),o.z+=o.dz,o.dx>0?o.dx+=5*t:o.dx-=5*t,o.dy>0?o.dy+=5*t:o.dy-=5*t,o.dz>0?o.dz+=5*t:o.dz-=5*t,(i(o.x)>600||i(o.y)>600||i(o.z)>600)&&(o.y=-3e3,this.curArr.splice(e,1),e--)}}}),cc._RF.pop()},{}],BtnMask:[function(t,e,o){"use strict";cc._RF.push(e,"dad11e/aSJLqrejeTiVWCOz","BtnMask"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){var t=this;this.mask=this.node.addComponent(cc.Mask),this.mask&&(this.mask._updateGraphics=function(){var e=t.mask._graphics;e.clear();var o=t.node.getBoundingBox(),n=o.width,i=o.height;e.roundRect(-n/2-1,-i/2-1,n+2,i+2,10),e.stroke(),e.fill()},this.mask._updateGraphics())}}),cc._RF.pop()},{}],DebugInfo:[function(t,e,o){"use strict";cc._RF.push(e,"9b73cd+oUNBlrjQnPpP4+EV","DebugInfo");var n=t("GameData"),i=n.getInstance();cc.Class({extends:cc.Component,properties:{},onLoad:function(){var t=[],e=[];this.node.children.forEach(function(o){t.push(o.getChildByName("Toggle").getComponent(cc.Toggle)),e.push(o.getChildByName("Label").getComponent(cc.Label))}),this.checkArr=t,this.labArr=e,t[3].interactable=!1,t[4].interactable=!1,t[5].interactable=!1,this._initEvent()},_initEvent:function(){var t=this;i.bindLab("gradeNum",this.labArr[3]),i.bindLab("totalEnemy",this.labArr[4]),i.bindLab("slipTimes",this.labArr[5]),i.on(n.Event.Game_Over,function(e){t.checkArr[0]._hideCheckMark(),t.checkArr[1]._hideCheckMark()})},onToggle:function(t,e){var o=t.isChecked,c=this.checkArr;"one"==e?i.emit(n.Event.Toggle_Check,1,o):"two"==e?(c[2].isChecked&&c[2]._hideCheckMark(),i.emit(n.Event.Toggle_Check,2,o)):"three"==e?(c[1].isChecked&&c[1]._hideCheckMark(),i.emit(n.Event.Toggle_Check,3,o)):"six"==e&&i.emit(n.Event.Toggle_Check,6,o)}}),cc._RF.pop()},{GameData:"GameData"}],DrawRect:[function(t,e,o){"use strict";cc._RF.push(e,"0de55tV8xlDa7m5PcYFZVPP","DrawRect"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){var t=this.node.getBoundingBox(),e=t.width,o=t.height,n=this.node.addComponent(cc.Graphics);n.clear(),n.strokeColor=cc.Color.RED,n.lineWidth=1,n.rect(-e/2,-o/2,e,o),n.stroke()}}),cc._RF.pop()},{}],GameData:[function(t,e,o){"use strict";cc._RF.push(e,"613e7AH6ElNMpp2BhEu/h1r","GameData");var n=null,i=cc.Class({name:"GameData",ctor:function(){this.mapLabel={},this.notify=new cc.EventTarget},properties:{_gradeNum:0,_slipTimes:0,_totalEnemy:0,_activeEnemy:0,gradeNum:{get:function(){return this._gradeNum},set:function(t){this._gradeNum=t,this._setMapLab("gradeNum",t),this._checkEnd(t)}},slipTimes:{get:function(){return this._slipTimes},set:function(t){this._slipTimes=t,this._setMapLab("slipTimes",t)}},totalEnemy:{get:function(){return this._totalEnemy},set:function(t){this._totalEnemy=t,this._setMapLab("totalEnemy",t+"/"+this.activeEnemy)}},activeEnemy:{get:function(){return this._activeEnemy},set:function(t){this._activeEnemy=t,this._setMapLab("totalEnemy",this.totalEnemy+"/"+t)}},drawSlide:!0,drawTail:!0},bindLab:function(t,e){this.mapLabel[t+"lab"]=e},_setMapLab:function(t,e){var o=this.mapLabel[t+"lab"];o&&(o.string=e)},_checkEnd:function(t){if(t>50)return console.log("Game_Over"),void this.emit(i.Event.Game_Over,{})},on:function(t,e,o){return this.notify.on(t,e,o)},once:function(t,e,o){this.notify.once(t,e,o)},emit:function(t,e,o,n,i){this.notify.emit(t,e,o,n,i)},off:function(t,e,o){this.notify.off(t,e,o)},coverFunc:function(){console.log("coverFunc")}});i.Event={},i.Event.Game_Over="Game_Over",i.Event.Toggle_Check="Toggle_Check",i.Event.Hit_Obstacle="Hit_Obstacle",i.getInstance=function(){return n||(n=new i),n},i.random=function(t,e){return Math.floor(Math.random()*(e-t))+t},i.prototype.coverFunc=function(){console.log("coverFunc _ prototype")},e.exports=i,cc._RF.pop()},{}],HelloWorld:[function(t,e,o){"use strict";cc._RF.push(e,"280c3rsZJJKnZ9RqbALVwtK","HelloWorld");var n=t("GameData"),i=n.getInstance(),c=n.random;cc.Class({extends:cc.Component,properties:{touch:cc.Node,cam3D:cc.Node,role:cc.Node,obstacle:cc.Node,motion:cc.Node,canvas:cc.Node},onLoad:function(){this._initData(),this._initKeyBoardTouch(),this._initEvent(),this._initRole()},_initEvent:function(){var t=this;i.on(n.Event.Game_Over,function(e){t.offBattleTouch(),alert("\u4f60\u597d\uff0c\u6e38\u620f\u7ed3\u675f")}),i.on(n.Event.Toggle_Check,this._onTogCheck,this),i.on(n.Event.Hit_Obstacle,function(e){t.shakeScene(40,1.5)})},_initRole:function(){this.role.y=0,this.role.y=-305;this.obstacle.getComponent("Obstacle").curArr[0]},_initData:function(){this.ratioSpeed=.5,this.moveSpeed=20,this.motionCmp=this.motion.getComponent(cc.MotionStreak),this.cam3DCmp=this.cam3D.getComponent(cc.Camera),this.bombCmp=this.node.getComponent("BombManager"),this.blockIpt=this.canvas.getChildByName("BlockInput").getComponent(cc.BlockInputEvents),this.cam3DAgl=this.cam3D.eulerAngles.clone(),this.cam3DPos=this.cam3D.position.clone(),this.touchArr=[];var t=new cc.Node;t.parent=this.canvas,t.group="ui";var e=t.addComponent(cc.Graphics);e.strokeColor=cc.Color.RED,this.g=e},setBlockInput:function(t){this.blockIpt.enabled=t},update:function(t){if(!(this.touchArr.length<1))if(i.drawSlide){var e=this.g;e.clear();for(var o=0;o<this.touchArr.length;o++){var n=this.touchArr[o],c=n[2];c-=t,this.touchArr[o][2]=c,c<0?(this.touchArr.splice(o,1),o--):(e.circle(n[0].x,n[0].y,4),this._checkRay(n[1]))}e.stroke()}else for(var s=0;s<this.touchArr.length;s++){var a=this.touchArr[s],h=a[2];h-=t,this.touchArr[s][2]=h,h<0?(this.touchArr.splice(s,1),s--):this._checkRay(a[1])}},_checkRay:function(t){for(var e=this.cam3DCmp.getRay(t),o=cc.geomUtils.intersect.raycast(this.obstacle,e),n=0;n<o.length;n++){var i=o[n].node;if(i.z<-3e3)break;this.bombCmp.lanuchOn(i.position),i.getComponent("Rotate").recovery(1)}},_setMotionStreak:function(t){var e=this.canvas.convertToNodeSpaceAR(t);i.drawTail&&(this.motion.position=e),this.touchPos=t,this.touchArr.push([e,t,.5])},onTouchStart:function(t){this._setMotionStreak(t.touch.getLocation()),this.motionCmp.reset()},onTouchMove:function(t){this._setMotionStreak(t.touch.getLocation())},onTouchEnd:function(t){this.touchPos=null,i.slipTimes+=1},onBattleTouch:function(){this.cam3D.eulerAngles=this.cam3DAgl,this.offBattleTouch(),this.touch.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.touch.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.touch.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.touch.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),this.touchPos=null},offBattleTouch:function(){this.touch.off(cc.Node.EventType.TOUCH_START),this.touch.off(cc.Node.EventType.TOUCH_MOVE),this.touch.off(cc.Node.EventType.TOUCH_END),this.touch.off(cc.Node.EventType.TOUCH_CANCEL),this.touchPos=null},onLookTouch:function(){var t=this;this.offBattleTouch(),this.touch.on(cc.Node.EventType.TOUCH_START,function(e){t.pos1=e.getLocation()}),this.touch.on(cc.Node.EventType.TOUCH_MOVE,function(e){var o=e.getLocation(),n=t.cam3D.eulerAngles.x,i=t.cam3D.eulerAngles.y,c=t.cam3D.eulerAngles.z;n-=(t.pos1.y-o.y)*t.ratioSpeed,i+=(t.pos1.x-o.x)*t.ratioSpeed,t.cam3D.eulerAngles=cc.v3(n,i,c),t.pos1=e.getLocation()})},_onTogCheck:function(t,e){if(2==t){if(e)return void this.onBattleTouch();this.offBattleTouch()}else if(3==t){if(e)return void this.onLookTouch();this.offBattleTouch()}else 6==t&&this.shakeScene(40,1)},onClickW:function(){this.role.z-=this.moveSpeed},onClickA:function(){this.role.x-=this.moveSpeed},onClickD:function(){this.role.x+=this.moveSpeed},onClickS:function(){this.role.z+=this.moveSpeed},_initKeyBoardTouch:function(){var t=this,e={87:"W",65:"A",83:"S",68:"D"};cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(o){var n="onClick"+e[o.keyCode];t[n]&&t[n]()})},shakeScene:function(t,e){var o=this;this.stopShake();var n=this.cam3D.position;console.log("pppp",n),e=e||.5,this.schedule(function(i){(t-=e)<0?o.stopShake():o.cam3D.position=cc.v3(c(-t,t)+n.x,c(-t,t)+n.y,c(-t,t)+n.z)},0)},stopShake:function(){this.unscheduleAllCallbacks(),this.cam3D.position=this.cam3DPos}}),cc._RF.pop()},{GameData:"GameData"}],Obstacle:[function(t,e,o){"use strict";cc._RF.push(e,"8c44cE8jYVBYoWtms6HZYrx","Obstacle");var n=t("GameData"),i=n.getInstance(),c=n.random;cc.Class({extends:cc.Component,properties:{},onLoad:function(){this._init(),this._initEvent()},_initEvent:function(){var t=this;i.on(n.Event.Game_Over,function(e){t.stopAttack()}),i.on(n.Event.Toggle_Check,this._onToggle,this)},update:function(t){if(!(this.dt<0))for(var e=0;e<this.curArr.length;e++){var o=this.curArr[e];if(o.dy>0)o.dy-=t;else if(-1!=o.dy){var n=cc.v3(c(-500,500),c(300,600),-3400);o.readyGo(0,c(10,20),n),o.dy=-1,i.totalEnemy+=1}}},recObs:function(t,e){e<0&&(i.activeEnemy+=1),e>0&&i.emit(n.Event.Hit_Obstacle),i.gradeNum+=e,t.dy=c(0,6),-1==t.name.indexOf("RotateOne")&&(t.dy=c(2,10))},attack:function(){this.dt=0;for(var t=0;t<this.curArr.length;t++){this.curArr[t].dy=c(0,10)}i.totalEnemy=0,i.slipTimes=0},stopAttack:function(){this.dt=-1},_init:function(){this.dt=-1;for(var t=[],e=this.node.children,o=e.length,n=0;n<o;n++){var i=e[n],c=cc.instantiate(i),s=i.addComponent("Rotate");s.dy=-1,s.hideRest(),s.initOwn(this),t.push(s),c.parent=this.node,(s=c.addComponent("RotateOne")).dy=-1,s.hideRest(),s.initOwn(this),t.push(s)}this.curArr=t},_onToggle:function(t,e){if(1==t)return e?(this.attack(),void(i.gradeNum=0)):void this.stopAttack()}}),cc._RF.pop()},{GameData:"GameData"}],RotateOne:[function(t,e,o){"use strict";cc._RF.push(e,"e8247W5KdFAUIlN1Vr1u/KU","RotateOne");var n=t("GameData").random,i=function(t,e,o,n,i){return Math.pow(1-i,3)*t+3*i*Math.pow(1-i,2)*e+3*Math.pow(i,2)*(1-i)*o+Math.pow(i,3)*n};cc.Class({extends:t("Rotate"),properties:{},readyGo:function(t,e,o){this.dt=-.2,this.delay=t,this.speed=e,this._getP123(),this.node.position=this.bp},update:function(t){if(!(this.delay<0||(this.node.eulerAngles=cc.v3(Date.now()/this.rotate,Date.now()/this.rotate,0),this.dt+=t,this.dt<this.delay))){this.dtl+=t/2;var e=i(0,this.pp1.x,this.pp2.x,this.pp3.x,this.dtl),o=i(0,this.pp1.y,this.pp2.y,this.pp3.y,this.dtl),c=i(0,this.pp1.z,this.pp2.z,this.pp3.z,this.dtl),s=this.scale+n(-8,8);this.node.setPosition(this.bp.x+e,this.bp.y+o,this.bp.z+c),this.node.setScale(s,s,s),this.dtl>1.5&&this.recovery(-1)}},_getP123:function(){var t=void 0,e=void 0,o=void 0,i=n(1,400);i>1&&i<100?(t=cc.v3(n(-4500,-4e3),n(2500,3e3),-3e3),e=cc.v3(n(1e3,1500),n(1e3,1500),-1e3),o=cc.v3(600,n(600,800),100)):i>100&&i<200?(t=cc.v3(n(-4500,-4e3),n(-500,-1e3),-3500),e=cc.v3(n(800,1200),n(1e3,1500),-2e3),o=cc.v3(n(400,500),n(700,900),-200)):i>200&&i<300?(t=cc.v3(n(4500,4e3),n(-500,-1e3),-3500),e=cc.v3(n(-3500,-2500),n(1500,2e3),-2e3),o=cc.v3(n(-1e3,-500),n(700,900),-200)):i>300&&i<400?(t=cc.v3(n(-500,500),n(-3e3,-1e3),-3e3),e=cc.v3(n(-2500,-1e3),n(1500,2e3),-1500),o=cc.v3(n(-500,0),n(700,900),100)):(t=cc.v3(n(-2e3,2e3),n(3e3,5e3),-3e3),e=cc.v3(n(-500,500),n(-4e3,-3500),-1500),o=cc.v3(n(-1e3,1e3),n(1e3,2e3),500));var c=t.sub(t),s=e.sub(t),a=o.sub(t);this.p1=t,this.p2=e,this.p3=o,this.pp1=c,this.pp2=s,this.pp3=a,this.dtl=0,this.bp=t}}),cc._RF.pop()},{GameData:"GameData",Rotate:"Rotate"}],Rotate:[function(t,e,o){"use strict";cc._RF.push(e,"0ad2bEYaRZOQ6xmgHRZucbT","Rotate");var n=t("GameData"),i=(n.getInstance(),n.random);cc.Class({extends:cc.Component,properties:{rotate:{type:cc.Integer,default:4},speed:{type:cc.Integer,default:10},delay:{type:cc.Integer,default:-1}},onLoad:function(){this.scale=this.node.scale,this.parent=this.node.parent,this.ownCmp=null},initOwn:function(t){this.ownCmp=t},hideRest:function(){this.node.position=cc.v3(0,-1e3,999),this.delay=-1,this.unscheduleAllCallbacks()},recovery:function(t){this.hideRest(),this.ownCmp.recObs(this,t)},readyGo:function(t,e,o){this.dt=0,this.delay=t,this.speed=e,this.node.position=o},update:function(t){if(!(this.delay<0)){this.node.eulerAngles=cc.v3(Date.now()/this.rotate,Date.now()/this.rotate,0),this.dt+=t;var e=this.node.z+(10*this.dt+this.speed),o=this.node.y+i(-10,10),n=this.node.x+i(-10,10),c=this.scale+i(-8,8);this.node.setPosition(n,o,e),this.node.setScale(c,c,c),this.node.z>1e3&&this.recovery(-1)}},reset:function(t){this.dt=0,this.node.x=i(-400,400),this.node.y=i(200,400),this.node.z=-3450,this.delay=i(0,4)}}),cc._RF.pop()},{GameData:"GameData"}]},{},["Bomb","BombManager","BtnMask","DebugInfo","DrawRect","GameData","HelloWorld","Obstacle","Rotate","RotateOne"]);