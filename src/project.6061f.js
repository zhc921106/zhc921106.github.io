window.__require=function t(o,n,e){function i(s,r){if(!n[s]){if(!o[s]){var h=s.split("/");if(h=h[h.length-1],!o[h]){var a="function"==typeof __require&&__require;if(!r&&a)return a(h,!0);if(c)return c(h,!0);throw new Error("Cannot find module '"+s+"'")}}var u=n[s]={exports:{}};o[s][0].call(u.exports,function(t){return i(o[s][1][t]||t)},u,u.exports,t,o,n,e)}return n[s].exports}for(var c="function"==typeof __require&&__require,s=0;s<e.length;s++)i(e[s]);return i}({BombManager:[function(t,o,n){"use strict";cc._RF.push(o,"56f73yKDhlCsahMKFdNXxIX","BombManager"),cc.Class({extends:cc.Component,properties:{bomb:cc.Node},onLoad:function(){var t=this.bomb.parent,o=cc.instantiate(this.bomb);o.parent=t;var n=[],e=this.bomb.getComponent("Bomb");e.addBomb(100),n.push(e),(e=o.getComponent("Bomb")).addBomb(100),n.push(e),this.cmps=n},lanuchOn:function(t){for(var o=[],n=0;n<this.cmps.length;n++){var e=this.cmps[n],i=e.getLen();if(i<20)return void e.lanuch(t);o.push([i,e])}2==o.length&&(o.sort(function(t,o){return t[0]<o[0]}),o[0][1].lanuch(t))}}),cc._RF.pop()},{}],Bomb:[function(t,o,n){"use strict";cc._RF.push(o,"5fcfc4Z7clDXoeudR1g8txp","Bomb");var e=function(t,o){return Math.random()*(o-t)+t},i=Math.abs;cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.curArr=[],this.hideSelf()},hideSelf:function(){this.node.z=-5e3},testLanuch:function(){var t=this,o=cc.v3(0,500,0);this.scheduleOnce(function(){t.lanuch(o)},2)},addBomb:function(t){for(var o=this.node.children[0],n=0;n<t;n++){cc.instantiate(o).parent=this.node}},getLen:function(){return this.curArr.length},lanuch:function(t){this.node.position=t,this.curArr.length=0;for(var o=this.node.children,n=0,e=o.length;n<e;n++){var i=o[n];i.position=cc.v3(0,0,0),i.setScale(30,30,30),this.curArr.push(i)}},update:function(t){if(!(this.curArr.length<1))for(var o=0;o<this.curArr.length;o++){var n=this.curArr[o];0==n.x&&(n.dx=e(-20,20)),n.x+=n.dx,0==n.y&&(n.dy=e(-20,20)),n.y+=n.dy,0==n.z&&(n.dz=e(-20,20)),n.z+=n.dz,n.dx>0?n.dx+=5*t:n.dx-=5*t,n.dy>0?n.dy+=5*t:n.dy-=5*t,n.dz>0?n.dz+=5*t:n.dz-=5*t,(i(n.x)>600||i(n.y)>600||i(n.z)>600)&&(n.y=-1e3,this.curArr.splice(o,1),o--)}}}),cc._RF.pop()},{}],HelloWorld:[function(t,o,n){"use strict";cc._RF.push(o,"280c3rsZJJKnZ9RqbALVwtK","HelloWorld"),cc.Class({extends:cc.Component,properties:{touch:cc.Node,cam3D:cc.Node,role:cc.Node,obstacle:cc.Node,bomb:cc.Component,motion:cc.Node,canvas:cc.Node},onLoad:function(){this._initData(),this._initTouch(),this._initKeyBoardTouch(),this._initDraw()},_checkRay:function(t){for(var o=this.cam3DCmp.getRay(t),n=cc.geomUtils.intersect.raycast(this.obstacle,o),e=0;e<n.length;e++){var i=n[e].node;this.bombCmp.lanuchOn(i.position),i.getComponent("Rotate").reset()}},_initMoveTouch:function(){var t=cc.find("Canvas");t.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),t.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),t.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.touchPos=null},onTouchStart:function(t){this.touchPos=t.touch.getLocation();this._setMotionStreak();this.motionCmp.reset()},onTouchMove:function(t){this.touchPos=t.touch.getLocation();var o=this._setMotionStreak();this.drawg(o,this.touchPos)},onTouchEnd:function(t){this.touchPos=null},_initData:function(){this.ratioSpeed=.5,this.moveSpeed=20,this.motionCmp=this.motion.getComponent(cc.MotionStreak),this.cam3DCmp=this.cam3D.getComponent(cc.Camera),this.bombCmp=this.node.getComponent("BombManager")},_initTouch:function(){this._initMoveTouch()},onClickW:function(){this.role.z-=this.moveSpeed},onClickA:function(){console.log("onClickA"),this.role.x-=this.moveSpeed},onClickD:function(){this.role.x+=this.moveSpeed},onClickS:function(){this.role.z+=this.moveSpeed},_setMotionStreak:function(t){var o=this.canvas.convertToNodeSpaceAR(this.touchPos);return this.motion.position=o,o},_initKeyBoardTouch:function(){var t=this,o={87:"W",65:"A",83:"S",68:"D"};cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(n){var e="onClick"+o[n.keyCode];t[e]&&t[e]()})},_initDraw:function(){var t=new cc.Node;t.parent=this.canvas,t.group="ui";var o=t.addComponent(cc.Graphics);o.strokeColor=cc.Color.RED,this.g=o,this.garr=[]},drawg:function(t,o){this.garr.unshift([t,o,.5])},update:function(t){if(this.garr.length>0){var o=this.g,n=this.garr;o.clear();for(var e=0;e<n.length;e++){var i=n[e],c=i[2];c-=t,n[e][2]=c,c<0?(n.splice(e,1),e--):(o.circle(i[0].x,i[0].y,4),this._checkRay(i[1]))}o.stroke()}}}),cc._RF.pop()},{}],Obstacle:[function(t,o,n){"use strict";cc._RF.push(o,"8c44cE8jYVBYoWtms6HZYrx","Obstacle"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this._init(),this._loop()},_init:function(){this.curMap={};for(var t=this.node.children,o=0;o<t.length;o++){var n=t[o];this.curMap[n.name]=n}},_loop:function(){for(var t in this.curMap){this.curMap[t].active=!0}},_copy:function(){for(var t in this.curMap){var o=this.curMap[t],n=cc.instantiate(o);n.parent=this.node,n.active=!0}},update:function(t){}}),cc._RF.pop()},{}],Rotate:[function(t,o,n){"use strict";cc._RF.push(o,"0ad2bEYaRZOQ6xmgHRZucbT","Rotate");var e=function(t,o){return Math.floor(Math.random()*(o-t))+t};cc.Class({extends:cc.Component,properties:{rotate:{type:cc.Integer,default:4},speed:{type:cc.Integer,default:30},delay:{type:cc.Integer,default:0}},_reset:function(){this.dt=0,this.node.x=e(-400,400),this.node.y=e(200,400),this.node.z=-3450},reset:function(t){this._reset(),this.delay=e(0,4)},onLoad:function(){this.scale=this.node.scale,this._reset()},update:function(t){if(this.node.eulerAngles=cc.v3(Date.now()/this.rotate,Date.now()/this.rotate,0),!(this.delay<0||(this.dt+=t,this.dt<this.delay)))if(this.node.z>1e3)this.reset();else{this.node.z+=10*this.dt+this.speed;var o=this.scale+e(-4,4);this.node.setScale(o,o,o)}}}),cc._RF.pop()},{}]},{},["Bomb","BombManager","HelloWorld","Obstacle","Rotate"]);