window.__require=function t(e,o,n){function c(s,h){if(!o[s]){if(!e[s]){var r=s.split("/");if(r=r[r.length-1],!e[r]){var a="function"==typeof __require&&__require;if(!h&&a)return a(r,!0);if(i)return i(r,!0);throw new Error("Cannot find module '"+s+"'")}}var u=o[s]={exports:{}};e[s][0].call(u.exports,function(t){return c(e[s][1][t]||t)},u,u.exports,t,e,o,n)}return o[s].exports}for(var i="function"==typeof __require&&__require,s=0;s<n.length;s++)c(n[s]);return c}({BombManager:[function(t,e,o){"use strict";cc._RF.push(e,"56f73yKDhlCsahMKFdNXxIX","BombManager"),cc.Class({extends:cc.Component,properties:{bomb:cc.Node},onLoad:function(){var t=this.bomb.parent,e=cc.instantiate(this.bomb);e.parent=t;var o=[],n=this.bomb.getComponent("Bomb");n.addBomb(30),o.push(n),(n=e.getComponent("Bomb")).addBomb(30),o.push(n),this.cmps=o},lanuchOn:function(t){for(var e=[],o=0;o<this.cmps.length;o++){var n=this.cmps[o],c=n.getLen();if(c<20)return void n.lanuch(t);e.push([c,n])}2==e.length&&(e.sort(function(t,e){return t[0]<e[0]}),e[0][1].lanuch(t))}}),cc._RF.pop()},{}],Bomb:[function(t,e,o){"use strict";cc._RF.push(e,"5fcfc4Z7clDXoeudR1g8txp","Bomb");var n=function(t,e){return Math.random()*(e-t)+t},c=Math.abs;cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.curArr=[],this.hideSelf()},hideSelf:function(){this.node.z=-5e3},testLanuch:function(){var t=this,e=cc.v3(0,500,0);this.scheduleOnce(function(){t.lanuch(e)},2)},addBomb:function(t){for(var e=this.node.children[0],o=0;o<t;o++){cc.instantiate(e).parent=this.node}},getLen:function(){return this.curArr.length},lanuch:function(t){this.node.position=t,this.curArr.length=0;for(var e=this.node.children,o=0,n=e.length;o<n;o++){var c=e[o];c.position=cc.v3(0,0,0),c.setScale(30,30,30),this.curArr.push(c)}},update:function(t){if(!(this.curArr.length<1))for(var e=0;e<this.curArr.length;e++){var o=this.curArr[e];0==o.x&&(o.dx=n(-20,20)),o.x+=o.dx,0==o.y&&(o.dy=n(-20,20)),o.y+=o.dy,0==o.z&&(o.dz=n(-20,20)),o.z+=o.dz,o.dx>0?o.dx+=5*t:o.dx-=5*t,o.dy>0?o.dy+=5*t:o.dy-=5*t,o.dz>0?o.dz+=5*t:o.dz-=5*t,(c(o.x)>600||c(o.y)>600||c(o.z)>600)&&(o.y=-1e3,this.curArr.splice(e,1),e--)}}}),cc._RF.pop()},{}],BtnMask:[function(t,e,o){"use strict";cc._RF.push(e,"dad11e/aSJLqrejeTiVWCOz","BtnMask"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){var t=this;this.mask=this.node.addComponent(cc.Mask),this.mask&&(this.mask._updateGraphics=function(){var e=t.mask._graphics;e.clear();var o=t.node.getBoundingBox(),n=o.width,c=o.height;e.roundRect(-n/2-1,-c/2-1,n+2,c+2,10),e.stroke(),e.fill()},this.mask._updateGraphics())}}),cc._RF.pop()},{}],DrawRect:[function(t,e,o){"use strict";cc._RF.push(e,"0de55tV8xlDa7m5PcYFZVPP","DrawRect"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){var t=this.node.getBoundingBox(),e=t.width,o=t.height,n=this.node.addComponent(cc.Graphics);n.clear(),n.strokeColor=cc.Color.RED,n.lineWidth=1,n.rect(-e/2,-o/2,e,o),n.stroke()}}),cc._RF.pop()},{}],HelloWorld:[function(t,e,o){"use strict";cc._RF.push(e,"280c3rsZJJKnZ9RqbALVwtK","HelloWorld"),cc.Class({extends:cc.Component,properties:{touch:cc.Node,cam3D:cc.Node,role:cc.Node,obstacle:cc.Node,bomb:cc.Component,motion:cc.Node,canvas:cc.Node,grade:cc.Label},onLoad:function(){var t=this;this._initData(),this._initKeyBoardTouch(),this._initDraw(),cc.notify=new cc.EventTarget,cc.notify.on("shit",function(e){t.gradeNum+=e.key,t.grade.string=t.gradeNum})},_checkRay:function(t){for(var e=this.cam3DCmp.getRay(t),o=cc.geomUtils.intersect.raycast(this.obstacle,e),n=0;n<o.length;n++){var c=o[n].node;this.bombCmp.lanuchOn(c.position),c.getComponent("Rotate").recovery(1),console.log(c.name,"\u627e\u5230\u4e86",c.z)}},onTouchStart:function(t){this.touchPos=t.touch.getLocation();var e=this._setMotionStreak();this.motionCmp.reset(),this.drawg(e,this.touchPos)},onTouchMove:function(t){this.touchPos=t.touch.getLocation();var e=this._setMotionStreak();this.drawg(e,this.touchPos)},onTouchEnd:function(t){this.touchPos=null},_initData:function(){this.ratioSpeed=.5,this.moveSpeed=20,this.motionCmp=this.motion.getComponent(cc.MotionStreak),this.cam3DCmp=this.cam3D.getComponent(cc.Camera),this.bombCmp=this.node.getComponent("BombManager"),this.gradeNum=0,this.blockIpt=this.canvas.getChildByName("BlockInput").getComponent(cc.BlockInputEvents),this.cam3DAgl=this.cam3D.eulerAngles.clone()},setBlockInput:function(t){this.blockIpt.enabled=t},onClickW:function(){this.role.z-=this.moveSpeed},onClickA:function(){this.role.x-=this.moveSpeed},onClickD:function(){this.role.x+=this.moveSpeed},onClickS:function(){this.role.z+=this.moveSpeed},_setMotionStreak:function(t){var e=this.canvas.convertToNodeSpaceAR(this.touchPos);return this.motion.position=e,e},_initKeyBoardTouch:function(){var t=this,e={87:"W",65:"A",83:"S",68:"D"};cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(o){var n="onClick"+e[o.keyCode];t[n]&&t[n]()})},_initDraw:function(){var t=new cc.Node;t.parent=this.canvas,t.group="ui";var e=t.addComponent(cc.Graphics);e.strokeColor=cc.Color.RED,this.g=e,this.garr=[];var o=[];this.canvas.getChildByName("DebugInfo").children.forEach(function(t){o.push(t.getChildByName("Toggle").getComponent(cc.Toggle))}),this.checkArr=o},drawg:function(t,e){this.garr.unshift([t,e,.5])},update:function(t){if(this.garr.length>0){var e=this.g,o=this.garr;e.clear();for(var n=0;n<o.length;n++){var c=o[n],i=c[2];i-=t,o[n][2]=i,i<0?(o.splice(n,1),n--):(e.circle(c[0].x,c[0].y,4),this._checkRay(c[1]))}e.stroke()}},onToggle:function(t,e){var o=t.isChecked,n=this.obstacle.getComponent("Obstacle"),c=this.checkArr;"one"==e?o?(n.attack(),this.cleanGrade()):n.stopAttack():"two"==e?(c[2].isChecked&&c[2]._hideCheckMark(),o?this.onBattleTouch():this.offBattleTouch()):"three"==e&&(c[1].isChecked&&c[1]._hideCheckMark(),o?this.onLookTouch():this.offBattleTouch())},cleanGrade:function(){this.gradeNum=0,this.grade.string=""},onBattleTouch:function(){this.cam3D.eulerAngles=this.cam3DAgl,this.offBattleTouch(),this.touch.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.touch.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.touch.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.touch.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),this.touchPos=null},offBattleTouch:function(){this.touch.off(cc.Node.EventType.TOUCH_START),this.touch.off(cc.Node.EventType.TOUCH_MOVE),this.touch.off(cc.Node.EventType.TOUCH_END),this.touch.off(cc.Node.EventType.TOUCH_CANCEL),this.touchPos=null},onLookTouch:function(){var t=this;this.offBattleTouch(),this.touch.on(cc.Node.EventType.TOUCH_START,function(e){t.pos1=e.getLocation()}),this.touch.on(cc.Node.EventType.TOUCH_MOVE,function(e){var o=e.getLocation(),n=t.cam3D.eulerAngles.x,c=t.cam3D.eulerAngles.y,i=t.cam3D.eulerAngles.z;n-=(t.pos1.y-o.y)*t.ratioSpeed,c+=(t.pos1.x-o.x)*t.ratioSpeed,t.cam3D.eulerAngles=cc.v3(n,c,i),t.pos1=e.getLocation()})}}),cc._RF.pop()},{}],Obstacle:[function(t,e,o){"use strict";cc._RF.push(e,"8c44cE8jYVBYoWtms6HZYrx","Obstacle");var n=function(t,e){return Math.floor(Math.random()*(e-t))+t};cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.node.on("recovery",this._recovery,this),this._init(),this._copy()},attack:function(){for(var t=this.node.children,e=0;e<t.length;e++){var o=t[e].getComponent("Rotate"),c=n(0,10),i=n(10,20);0==e&&(c=1),this._sendBullet(o,c,i)}},stopAttack:function(){for(var t=this.node.children,e=0;e<t.length;e++){t[e].getComponent("Rotate").hideRest()}},_recovery:function(t){var e=t.cmp,o=t.num;cc.notify.emit("shit",{key:o}),this._sendBullet(e,n(0,5),n(10,20))},_sendBullet:function(t,e,o){var c=n(-500,500),i=n(300,600);t.readyGo(e,o,c,i)},_init:function(){this.curMap={};for(var t=this.node.children,e=0;e<t.length;e++){var o=t[e],n=o.getComponent("Rotate");n.hideRest(),this.curMap[o.name]=n}},_copy:function(){for(var t in this.curMap){var e=this.curMap[t].node;cc.instantiate(e).parent=this.node}},update:function(t){}}),cc._RF.pop()},{}],Rotate:[function(t,e,o){"use strict";cc._RF.push(e,"0ad2bEYaRZOQ6xmgHRZucbT","Rotate");var n=function(t,e){return Math.floor(Math.random()*(e-t))+t};cc.Class({extends:cc.Component,properties:{rotate:{type:cc.Integer,default:4},speed:{type:cc.Integer,default:30},delay:{type:cc.Integer,default:-1}},onLoad:function(){this.scale=this.node.scale,this.parent=this.node.parent},hideRest:function(){this.node.position=cc.v3(0,-1e3,999),this.delay=-1,this.unscheduleAllCallbacks()},recovery:function(t){this.hideRest(),this.sendEve("recovery",{cmp:this,num:t})},readyGo:function(t,e,o,n){var c=this;this.dt=-.2,this.delay=t,this.speed=e,this.scheduleOnce(function(){c.node.position=cc.v3(o,n,-3400)},this.delay)},update:function(t){if(!(this.delay<0||(this.node.eulerAngles=cc.v3(Date.now()/this.rotate,Date.now()/this.rotate,0),this.dt+=t,this.dt<this.delay))){this.node.z+=10*this.dt+this.speed,this.node.y=this.node.y+n(-10,10),this.node.x=this.node.x+n(-10,10);var e=this.scale+n(-4,4);this.node.setScale(e,e,e),this.node.z>1e3&&this.recovery(-1)}},sendEve:function(t,e){this.parent.emit(t,e)},_reset:function(){this.dt=0,this.node.x=n(-400,400),this.node.y=n(200,400),this.node.z=-3450},reset:function(t){this._reset(),this.delay=n(0,4)}}),cc._RF.pop()},{}]},{},["Bomb","BombManager","BtnMask","DrawRect","HelloWorld","Obstacle","Rotate"]);