window.__require=function t(e,o,n){function c(s,a){if(!o[s]){if(!e[s]){var h=s.split("/");if(h=h[h.length-1],!e[h]){var r="function"==typeof __require&&__require;if(!a&&r)return r(h,!0);if(i)return i(h,!0);throw new Error("Cannot find module '"+s+"'")}}var u=o[s]={exports:{}};e[s][0].call(u.exports,function(t){return c(e[s][1][t]||t)},u,u.exports,t,e,o,n)}return o[s].exports}for(var i="function"==typeof __require&&__require,s=0;s<n.length;s++)c(n[s]);return c}({BombManager:[function(t,e,o){"use strict";cc._RF.push(e,"56f73yKDhlCsahMKFdNXxIX","BombManager"),cc.Class({extends:cc.Component,properties:{bomb:cc.Node},onLoad:function(){var t=this.bomb.parent,e=cc.instantiate(this.bomb);e.parent=t;var o=[],n=this.bomb.getComponent("Bomb");n.addBomb(30),o.push(n),(n=e.getComponent("Bomb")).addBomb(30),o.push(n),this.cmps=o},lanuchOn:function(t){for(var e=[],o=0;o<this.cmps.length;o++){var n=this.cmps[o],c=n.getLen();if(c<20)return void n.lanuch(t);e.push([c,n])}2==e.length&&(e.sort(function(t,e){return t[0]<e[0]}),e[0][1].lanuch(t))}}),cc._RF.pop()},{}],Bomb:[function(t,e,o){"use strict";cc._RF.push(e,"5fcfc4Z7clDXoeudR1g8txp","Bomb");var n=function(t,e){return Math.random()*(e-t)+t},c=Math.abs;cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.curArr=[],this.hideSelf()},hideSelf:function(){this.node.position=cc.v3(0,-5e3,2e3)},testLanuch:function(){var t=this,e=cc.v3(0,500,0);this.scheduleOnce(function(){t.lanuch(e)},2)},addBomb:function(t){for(var e=this.node.children[0],o=0;o<t;o++){cc.instantiate(e).parent=this.node}},getLen:function(){return this.curArr.length},lanuch:function(t){this.node.position=t,this.curArr.length=0;for(var e=this.node.children,o=0,n=e.length;o<n;o++){var c=e[o];c.position=cc.v3(0,0,0),c.setScale(30,30,30),this.curArr.push(c)}},update:function(t){if(!(this.curArr.length<1))for(var e=0;e<this.curArr.length;e++){var o=this.curArr[e];0==o.x&&(o.dx=n(-20,20)),o.x+=o.dx,0==o.y&&(o.dy=n(-20,20)),o.y+=o.dy,0==o.z&&(o.dz=n(-20,20)),o.z+=o.dz,o.dx>0?o.dx+=5*t:o.dx-=5*t,o.dy>0?o.dy+=5*t:o.dy-=5*t,o.dz>0?o.dz+=5*t:o.dz-=5*t,(c(o.x)>600||c(o.y)>600||c(o.z)>600)&&(o.y=-3e3,this.curArr.splice(e,1),e--)}}}),cc._RF.pop()},{}],BtnMask:[function(t,e,o){"use strict";cc._RF.push(e,"dad11e/aSJLqrejeTiVWCOz","BtnMask"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){var t=this;this.mask=this.node.addComponent(cc.Mask),this.mask&&(this.mask._updateGraphics=function(){var e=t.mask._graphics;e.clear();var o=t.node.getBoundingBox(),n=o.width,c=o.height;e.roundRect(-n/2-1,-c/2-1,n+2,c+2,10),e.stroke(),e.fill()},this.mask._updateGraphics())}}),cc._RF.pop()},{}],DrawRect:[function(t,e,o){"use strict";cc._RF.push(e,"0de55tV8xlDa7m5PcYFZVPP","DrawRect"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){var t=this.node.getBoundingBox(),e=t.width,o=t.height,n=this.node.addComponent(cc.Graphics);n.clear(),n.strokeColor=cc.Color.RED,n.lineWidth=1,n.rect(-e/2,-o/2,e,o),n.stroke()}}),cc._RF.pop()},{}],GameData:[function(t,e,o){"use strict";cc._RF.push(e,"613e7AH6ElNMpp2BhEu/h1r","GameData");var n=null,c=cc.Class({name:"GameData",ctor:function(){this.mapLabel={}},properties:{_gradeNum:0,_slipTimes:0,_totalEnemy:0,_activeEnemy:0,gradeNum:{get:function(){return this._gradeNum},set:function(t){this._gradeNum=t,this._setMapLab("gradeNum",t)}},slipTimes:{get:function(){return this._slipTimes},set:function(t){this._slipTimes=t,this._setMapLab("slipTimes",t)}},totalEnemy:{get:function(){return this._totalEnemy},set:function(t){this._totalEnemy=t,this._setMapLab("totalEnemy",t+"/"+this.activeEnemy)}},activeEnemy:{get:function(){return this._activeEnemy},set:function(t){this._activeEnemy=t,this._setMapLab("totalEnemy",this.totalEnemy+"/"+t)}}},bindLab:function(t,e){this.mapLabel[t+"lab"]=e},_setMapLab:function(t,e){var o=this.mapLabel[t+"lab"];o&&(o.string=e)}});c.getInstance=function(){return n||(n=new c),n},c.prototype.ca=function(){console.log("ca1")},e.exports=c,cc._RF.pop()},{}],HelloWorld:[function(t,e,o){"use strict";cc._RF.push(e,"280c3rsZJJKnZ9RqbALVwtK","HelloWorld");var n=t("GameData").getInstance();cc.Class({extends:cc.Component,properties:{touch:cc.Node,cam3D:cc.Node,role:cc.Node,obstacle:cc.Node,bomb:cc.Component,motion:cc.Node,canvas:cc.Node},onLoad:function(){this._initData(),this._initKeyBoardTouch(),this._initDraw(),n.bindLab("gradeNum",this.labArr[3]),n.bindLab("totalEnemy",this.labArr[4]),n.bindLab("slipTimes",this.labArr[5])},_checkRay:function(t){for(var e=this.cam3DCmp.getRay(t),o=cc.geomUtils.intersect.raycast(this.obstacle,e),n=0;n<o.length;n++){var c=o[n].node;this.bombCmp.lanuchOn(c.position),c.getComponent("Rotate").recovery(1)}},_initRole:function(){this.role.y=0,this.role.y=-105;this.obstacle.getComponent("Obstacle").getObs().readyGo(0,1)},onTouchStart:function(t){this.touchPos=t.touch.getLocation();var e=this._setMotionStreak();this.motionCmp.reset(),this.drawg(e,this.touchPos)},onTouchMove:function(t){this.touchPos=t.touch.getLocation();var e=this._setMotionStreak();this.drawg(e,this.touchPos)},onTouchEnd:function(t){this.touchPos=null,n.slipTimes+=1},_initData:function(){this.ratioSpeed=.5,this.moveSpeed=20,this.motionCmp=this.motion.getComponent(cc.MotionStreak),this.cam3DCmp=this.cam3D.getComponent(cc.Camera),this.bombCmp=this.node.getComponent("BombManager"),this.blockIpt=this.canvas.getChildByName("BlockInput").getComponent(cc.BlockInputEvents),this.cam3DAgl=this.cam3D.eulerAngles.clone()},setBlockInput:function(t){this.blockIpt.enabled=t},onClickW:function(){this.role.z-=this.moveSpeed},onClickA:function(){this.role.x-=this.moveSpeed},onClickD:function(){this.role.x+=this.moveSpeed},onClickS:function(){this.role.z+=this.moveSpeed},_initKeyBoardTouch:function(){var t=this,e={87:"W",65:"A",83:"S",68:"D"};cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(o){var n="onClick"+e[o.keyCode];t[n]&&t[n]()})},_setMotionStreak:function(t){var e=this.canvas.convertToNodeSpaceAR(this.touchPos);return this.motion.position=e,e},_initDraw:function(){var t=this,e=new cc.Node;e.parent=this.canvas,e.group="ui";var o=e.addComponent(cc.Graphics);o.strokeColor=cc.Color.RED,this.g=o,this.garr=[];var n=[],c=[];this.canvas.getChildByName("DebugInfo").children.forEach(function(t){n.push(t.getChildByName("Toggle").getComponent(cc.Toggle)),c.push(t.getChildByName("Label").getComponent(cc.Label))}),this.checkArr=n,this.labArr=c,cc.notify=new cc.EventTarget,cc.notify.on("shit",function(e){t.setGrade(e.key)}),n[3].interactable=!1,n[4].interactable=!1,n[5].interactable=!1},drawg:function(t,e){this.garr.unshift([t,e,.5])},update:function(t){if(this.garr.length>0){var e=this.g,o=this.garr;e.clear();for(var n=0;n<o.length;n++){var c=o[n],i=c[2];i-=t,o[n][2]=i,i<0?(o.splice(n,1),n--):(e.circle(c[0].x,c[0].y,4),this._checkRay(c[1]))}e.stroke()}},onToggle:function(t,e){var o=t.isChecked,n=this.obstacle.getComponent("Obstacle"),c=this.checkArr;"one"==e?o?(n.attack(),this.cleanGrade()):n.stopAttack():"two"==e?(c[2].isChecked&&c[2]._hideCheckMark(),o?this.onBattleTouch():this.offBattleTouch()):"three"==e&&(c[1].isChecked&&c[1]._hideCheckMark(),o?this.onLookTouch():this.offBattleTouch())},onBattleTouch:function(){this.cam3D.eulerAngles=this.cam3DAgl,this.offBattleTouch(),this.touch.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.touch.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.touch.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.touch.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),this.touchPos=null},offBattleTouch:function(){this.touch.off(cc.Node.EventType.TOUCH_START),this.touch.off(cc.Node.EventType.TOUCH_MOVE),this.touch.off(cc.Node.EventType.TOUCH_END),this.touch.off(cc.Node.EventType.TOUCH_CANCEL),this.touchPos=null},onLookTouch:function(){var t=this;this.offBattleTouch(),this.touch.on(cc.Node.EventType.TOUCH_START,function(e){t.pos1=e.getLocation()}),this.touch.on(cc.Node.EventType.TOUCH_MOVE,function(e){var o=e.getLocation(),n=t.cam3D.eulerAngles.x,c=t.cam3D.eulerAngles.y,i=t.cam3D.eulerAngles.z;n-=(t.pos1.y-o.y)*t.ratioSpeed,c+=(t.pos1.x-o.x)*t.ratioSpeed,t.cam3D.eulerAngles=cc.v3(n,c,i),t.pos1=e.getLocation()})},_test:function(){this.scheduleOnce(function(){var t=cc.director.getScene();if(t){var e=t.children;console.log("----scene childs-----"),e.forEach(function(t){console.log(t.name,t.zIndex)})}},1)},setGrade:function(t){n.gradeNum+=t},cleanGrade:function(){n.gradeNum=0}}),cc._RF.pop()},{GameData:"GameData"}],Obstacle:[function(t,e,o){"use strict";cc._RF.push(e,"8c44cE8jYVBYoWtms6HZYrx","Obstacle");var n=t("GameData").getInstance(),c=function(t,e){return Math.floor(Math.random()*(e-t))+t};cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.node.on("recovery",this.recovery,this),this._init(),n.totalEnemy=0},update:function(t){if(!(this.dt<0))for(var e=0;e<this.curArr.length;e++){var o=this.curArr[e];o.dy>0?o.dy-=t:-1!=o.dy&&(o.readyGo(0,c(10,20),c(-500,500),c(300,600)),o.dy=-1,n.totalEnemy+=1)}},recovery:function(t){var e=t.cmp,o=t.num;o<0&&(n.activeEnemy+=1),cc.notify.emit("shit",{key:o}),e.dy=c(0,10)},attack:function(){this.dt=0;for(var t=0;t<this.curArr.length;t++){this.curArr[t].dy=c(0,10)}},stopAttack:function(){this.dt=-1},getObs:function(){return this.curMap.box},_init:function(){this.dt=-1;for(var t=[],e=this.node.children,o=e.length,n=0;n<o;n++){var c=e[n],i=cc.instantiate(c),s=c.addComponent("Rotate");s.hideRest(),t.push(s),(s=i.addComponent("RotateOne")).hideRest(),t.push(s),i.parent=this.node}this.curArr=t}}),cc._RF.pop()},{GameData:"GameData"}],RotateOne:[function(t,e,o){"use strict";cc._RF.push(e,"e8247W5KdFAUIlN1Vr1u/KU","RotateOne");var n=function(t,e){return Math.floor(Math.random()*(e-t))+t},c=function(t,e,o,n,c){return Math.pow(1-c,3)*t+3*c*Math.pow(1-c,2)*e+3*Math.pow(c,2)*(1-c)*o+Math.pow(c,3)*n};cc.Class({extends:t("Rotate"),properties:{},_getP123:function(){var t=void 0,e=void 0,o=void 0,c=n(1,400);c>1&&c<100?(t=cc.v3(n(-4500,-4e3),n(2500,3e3),-3e3),e=cc.v3(n(1e3,1500),n(1e3,1500),-1e3),o=cc.v3(600,n(600,800),100)):c>100&&c<200?(t=cc.v3(n(-4500,-4e3),n(-500,-1e3),-3500),e=cc.v3(n(800,1200),n(1e3,1500),-2e3),o=cc.v3(n(400,500),n(700,900),-200)):c>200&&c<300?(t=cc.v3(n(4500,4e3),n(-500,-1e3),-3500),e=cc.v3(n(-3500,-2500),n(1500,2e3),-2e3),o=cc.v3(n(-1e3,-500),n(700,900),-200)):c>300&&c<400?(t=cc.v3(n(-500,500),n(-3e3,-1e3),-3e3),e=cc.v3(n(-2500,-1e3),n(1500,2e3),-1500),o=cc.v3(n(-500,0),n(700,900),100)):(t=cc.v3(n(-2e3,2e3),n(3e3,5e3),-3e3),e=cc.v3(n(-500,500),n(-4e3,-3500),-1500),o=cc.v3(n(-1e3,1e3),n(1e3,2e3),500)),console.log("p1"+t+"\np2"+e+"\np3"+o);var i=t.sub(t),s=e.sub(t),a=o.sub(t);this.p1=t,this.p2=e,this.p3=o,this.pp1=i,this.pp2=s,this.pp3=a,this.dtl=0,this.bp=t},readyGo:function(t,e,o,n){this.dt=-.2,this.delay=t,this.speed=e,this._getP123(),this.node.position=this.bp},update:function(t){if(!(this.delay<0||(this.node.eulerAngles=cc.v3(Date.now()/this.rotate,Date.now()/this.rotate,0),this.dt+=t,this.dt<this.delay))){this.dtl+=t/2;var e=c(0,this.pp1.x,this.pp2.x,this.pp3.x,this.dtl),o=c(0,this.pp1.y,this.pp2.y,this.pp3.y,this.dtl),i=c(0,this.pp1.z,this.pp2.z,this.pp3.z,this.dtl),s=cc.v3(this.bp.x+e,this.bp.y+o,this.bp.z+i);this.node.position=s;var a=this.scale+n(-4,4);this.node.setScale(a,a,a),this.dtl>1.5&&this.recovery(-1)}}}),cc._RF.pop()},{Rotate:"Rotate"}],Rotate:[function(t,e,o){"use strict";cc._RF.push(e,"0ad2bEYaRZOQ6xmgHRZucbT","Rotate");var n=function(t,e){return Math.floor(Math.random()*(e-t))+t};cc.Class({extends:cc.Component,properties:{rotate:{type:cc.Integer,default:4},speed:{type:cc.Integer,default:10},delay:{type:cc.Integer,default:-1}},onLoad:function(){this.scale=this.node.scale,this.parent=this.node.parent},hideRest:function(){this.node.position=cc.v3(0,-1e3,999),this.delay=-1,this.unscheduleAllCallbacks()},recovery:function(t){this.hideRest(),this.sendEve("recovery",{cmp:this,num:t})},readyGo:function(t,e,o,n){this.dt=0,this.delay=t,this.speed=e,this.node.position=cc.v3(o,n,-3400)},update:function(t){if(!(this.delay<0)){this.node.eulerAngles=cc.v3(Date.now()/this.rotate,Date.now()/this.rotate,0),this.dt+=t,this.node.z+=10*this.dt+this.speed,this.node.y=this.node.y+n(-10,10),this.node.x=this.node.x+n(-10,10);var e=this.scale+n(-4,4);this.node.setScale(e,e,e),this.node.z>1e3&&this.recovery(-1)}},sendEve:function(t,e){this.parent.emit(t,e)},reset:function(t){this.dt=0,this.node.x=n(-400,400),this.node.y=n(200,400),this.node.z=-3450,this.delay=n(0,4)}}),cc._RF.pop()},{}]},{},["Bomb","BombManager","BtnMask","DrawRect","GameData","HelloWorld","Obstacle","Rotate","RotateOne"]);