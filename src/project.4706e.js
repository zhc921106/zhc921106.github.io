window.__require=function t(o,e,n){function i(s,r){if(!e[s]){if(!o[s]){var a=s.split("/");if(a=a[a.length-1],!o[a]){var h="function"==typeof __require&&__require;if(!r&&h)return h(a,!0);if(c)return c(a,!0);throw new Error("Cannot find module '"+s+"'")}}var u=e[s]={exports:{}};o[s][0].call(u.exports,function(t){return i(o[s][1][t]||t)},u,u.exports,t,o,e,n)}return e[s].exports}for(var c="function"==typeof __require&&__require,s=0;s<n.length;s++)i(n[s]);return i}({BombManager:[function(t,o,e){"use strict";cc._RF.push(o,"56f73yKDhlCsahMKFdNXxIX","BombManager"),cc.Class({extends:cc.Component,properties:{bomb:cc.Node},onLoad:function(){var t=this.bomb.parent,o=cc.instantiate(this.bomb);o.parent=t;var e=[],n=this.bomb.getComponent("Bomb");n.addBomb(60),e.push(n),(n=o.getComponent("Bomb")).addBomb(60),e.push(n),this.cmps=e},lanuchOn:function(t){for(var o=[],e=0;e<this.cmps.length;e++){var n=this.cmps[e],i=n.getLen();if(i<20)return void n.lanuch(t);o.push([i,n])}2==o.length&&(o.sort(function(t,o){return t[0]<o[0]}),o[0][1].lanuch(t))}}),cc._RF.pop()},{}],Bomb:[function(t,o,e){"use strict";cc._RF.push(o,"5fcfc4Z7clDXoeudR1g8txp","Bomb");var n=function(t,o){return Math.random()*(o-t)+t},i=Math.abs;cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.curArr=[],this.hideSelf()},hideSelf:function(){this.node.z=-5e3},testLanuch:function(){var t=this,o=cc.v3(0,500,0);this.scheduleOnce(function(){t.lanuch(o)},2)},addBomb:function(t){for(var o=this.node.children[0],e=0;e<t;e++){cc.instantiate(o).parent=this.node}},getLen:function(){return this.curArr.length},lanuch:function(t){this.node.position=t,this.curArr.length=0;for(var o=this.node.children,e=0,n=o.length;e<n;e++){var i=o[e];i.position=cc.v3(0,0,0),i.setScale(30,30,30),this.curArr.push(i)}},update:function(t){if(!(this.curArr.length<1))for(var o=0;o<this.curArr.length;o++){var e=this.curArr[o];0==e.x&&(e.dx=n(-20,20)),e.x+=e.dx,0==e.y&&(e.dy=n(-20,20)),e.y+=e.dy,0==e.z&&(e.dz=n(-20,20)),e.z+=e.dz,e.dx>0?e.dx+=5*t:e.dx-=5*t,e.dy>0?e.dy+=5*t:e.dy-=5*t,e.dz>0?e.dz+=5*t:e.dz-=5*t,(i(e.x)>600||i(e.y)>600||i(e.z)>600)&&(e.y=-1e3,this.curArr.splice(o,1),o--)}}}),cc._RF.pop()},{}],HelloWorld:[function(t,o,e){"use strict";cc._RF.push(o,"280c3rsZJJKnZ9RqbALVwtK","HelloWorld"),cc.Class({extends:cc.Component,properties:{touch:cc.Node,cam3D:cc.Node,role:cc.Node,obstacle:cc.Node,bomb:cc.Component,motion:cc.Node,canvas:cc.Node,grade:cc.Label},onLoad:function(){var t=this;this._initData(),this._initTouch(),this._initKeyBoardTouch(),this._initDraw(),cc.notify=new cc.EventTarget,cc.notify.on("shit",function(o){t.gradeNum+=o.key,console.log("\u63a5\u53d7\u5230",o,t.gradeNum),t.grade.string=t.gradeNum})},_checkRay:function(t){for(var o=this.cam3DCmp.getRay(t),e=cc.geomUtils.intersect.raycast(this.obstacle,o),n=0;n<e.length;n++){var i=e[n].node;this.bombCmp.lanuchOn(i.position),i.getComponent("Rotate").reset(),console.log("\u51fb\u788e\u4e86\u8fd9\u4e2a-------"),cc.notify.emit("shit",{key:1})}},_initMoveTouch:function(){var t=cc.find("Canvas");t.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),t.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),t.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.touchPos=null},onTouchStart:function(t){this.touchPos=t.touch.getLocation();this._setMotionStreak();this.motionCmp.reset()},onTouchMove:function(t){this.touchPos=t.touch.getLocation();var o=this._setMotionStreak();this.drawg(o,this.touchPos)},onTouchEnd:function(t){this.touchPos=null},_initData:function(){this.ratioSpeed=.5,this.moveSpeed=20,this.motionCmp=this.motion.getComponent(cc.MotionStreak),this.cam3DCmp=this.cam3D.getComponent(cc.Camera),this.bombCmp=this.node.getComponent("BombManager"),this.gradeNum=0},_initTouch:function(){this._initMoveTouch()},onClickW:function(){this.role.z-=this.moveSpeed},onClickA:function(){console.log("onClickA"),this.role.x-=this.moveSpeed},onClickD:function(){this.role.x+=this.moveSpeed},onClickS:function(){this.role.z+=this.moveSpeed},_setMotionStreak:function(t){var o=this.canvas.convertToNodeSpaceAR(this.touchPos);return this.motion.position=o,o},_initKeyBoardTouch:function(){var t=this,o={87:"W",65:"A",83:"S",68:"D"};cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(e){var n="onClick"+o[e.keyCode];t[n]&&t[n]()})},_initDraw:function(){var t=new cc.Node;t.parent=this.canvas,t.group="ui";var o=t.addComponent(cc.Graphics);o.strokeColor=cc.Color.RED,this.g=o,this.garr=[]},drawg:function(t,o){this.garr.unshift([t,o,.5])},update:function(t){if(this.garr.length>0){var o=this.g,e=this.garr;o.clear();for(var n=0;n<e.length;n++){var i=e[n],c=i[2];c-=t,e[n][2]=c,c<0?(e.splice(n,1),n--):(o.circle(i[0].x,i[0].y,4),this._checkRay(i[1]))}o.stroke()}}}),cc._RF.pop()},{}],Obstacle:[function(t,o,e){"use strict";cc._RF.push(o,"8c44cE8jYVBYoWtms6HZYrx","Obstacle"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this._init(),this._loop()},_init:function(){this.curMap={};for(var t=this.node.children,o=0;o<t.length;o++){var e=t[o];this.curMap[e.name]=e}},_loop:function(){for(var t in this.curMap){this.curMap[t].active=!0}},_copy:function(){for(var t in this.curMap){var o=this.curMap[t],e=cc.instantiate(o);e.parent=this.node,e.active=!0}},update:function(t){}}),cc._RF.pop()},{}],Rotate:[function(t,o,e){"use strict";cc._RF.push(o,"0ad2bEYaRZOQ6xmgHRZucbT","Rotate");var n=function(t,o){return Math.floor(Math.random()*(o-t))+t};cc.Class({extends:cc.Component,properties:{rotate:{type:cc.Integer,default:4},speed:{type:cc.Integer,default:30},delay:{type:cc.Integer,default:0}},_reset:function(){this.dt=0,this.node.x=n(-400,400),this.node.y=n(200,400),this.node.z=-3450},reset:function(t){this._reset(),this.delay=n(0,4)},onLoad:function(){this.scale=this.node.scale,this._reset()},update:function(t){if(this.node.eulerAngles=cc.v3(Date.now()/this.rotate,Date.now()/this.rotate,0),!(this.delay<0||(this.dt+=t,this.dt<this.delay))){if(this.node.z>1e3)return this.reset(),console.log("\u9057\u6f0f\u4e86\u8fd9\u4e2a-------"),void cc.notify.emit("shit",{key:-1});this.node.z+=10*this.dt+this.speed;var o=this.scale+n(-4,4);this.node.setScale(o,o,o)}}}),cc._RF.pop()},{}]},{},["Bomb","BombManager","HelloWorld","Obstacle","Rotate"]);